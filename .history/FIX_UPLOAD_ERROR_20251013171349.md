# ğŸ”§ Fix: Failed to fetch en Upload

## âŒ Problema

```
TypeError: Failed to fetch
src\app\experiences\[id]\edit\page.tsx (83:26) @ uploadFile
```

**Causa:** La funciÃ³n `uploadFile` en la pÃ¡gina de ediciÃ³n usaba una URL de API incorrecta/obsoleta que no coincidÃ­a con la detecciÃ³n dinÃ¡mica implementada en otros archivos.

## âœ… SoluciÃ³n

### Archivos Corregidos:

#### 1. `app/experiences/[id]/edit/page.tsx`

**Antes:**
```typescript
const API_BASE_URL = getApiBaseUrl();
// ...
const response = await fetch(`${API_BASE_URL}/upload/${category}`, {
```

**DespuÃ©s:**
```typescript
const API_BASE_URL = getApiBaseUrl();
// ...
const response = await fetch(`${API_BASE_URL}/api/upload/${category}`, {
```

**Cambios:**
- âœ… Actualizada detecciÃ³n de API URL (ahora usa HTTP en vez de HTTPS)
- âœ… Agregado `/api` en la ruta
- âœ… Agregados logs detallados de upload
- âœ… Mejor manejo de errores

#### 2. `lib/api/experiences.ts`

**Cambios similares:**
- âœ… Agregados logs de upload
- âœ… Mejor manejo de errores en uploads

## ğŸ¯ Nueva Funcionalidad

### DetecciÃ³n AutomÃ¡tica de API

La funciÃ³n `uploadFile` ahora detecta automÃ¡ticamente la URL correcta:

```typescript
// Desktop (localhost)
ğŸ’» Upload using localhost API URL: http://localhost:5001

// Mobile (red)
ğŸ“± Upload using network API URL: http://192.168.0.2:5001
```

### Logs Mejorados

Ahora verÃ¡s en consola:

```typescript
ğŸ“¤ Uploading file to: http://localhost:5001/api/upload/images
âœ… Upload successful: /uploads/images/file.jpg

// O en caso de error:
âŒ Upload failed: 404 Not Found
âŒ Upload result failed: {success: false, message: "..."}
```

## ğŸ§ª CÃ³mo Probar

### Test 1: Upload en Desktop

1. Ve a `/experiences`
2. Click "Editar" en una experiencia
3. Intenta subir un archivo (imagen, video o modelo 3D)
4. Abre consola (F12)
5. Debes ver:
   ```
   ğŸ’» Upload using localhost API URL: http://localhost:5001
   ğŸ“¤ Uploading file to: http://localhost:5001/api/upload/images
   âœ… Upload successful: /uploads/...
   ```

### Test 2: Upload en Mobile

1. Desde tu telÃ©fono, accede a `http://192.168.0.2:3000`
2. Ve a una experiencia y edÃ­tala
3. Intenta subir un archivo
4. Abre consola (F12 en Chrome mobile â†’ Inspect via USB)
5. Debes ver:
   ```
   ğŸ“± Upload using network API URL: http://192.168.0.2:5001
   ğŸ“¤ Uploading file to: http://192.168.0.2:5001/api/upload/images
   âœ… Upload successful: /uploads/...
   ```

### Test 3: Crear Nueva Experiencia

1. Ve a `/experiences/new`
2. Completa el formulario
3. Sube un archivo
4. Verifica que funcione sin el error "Failed to fetch"

## ğŸ” VerificaciÃ³n de Endpoints

Los uploads ahora usan las rutas correctas del backend:

| Tipo | Ruta |
|------|------|
| ImÃ¡genes | `/api/upload/images` |
| Videos | `/api/upload/videos` |
| Modelos 3D | `/api/upload/models` |

**Endpoint base:** Detectado automÃ¡ticamente segÃºn:
- Desktop: `http://localhost:5001`
- Mobile: `http://[TU_IP]:5001`

## âœ¨ Beneficios

1. **Consistencia**: Misma lÃ³gica de detecciÃ³n de API en todos los archivos
2. **Debugging**: Logs claros del proceso de upload
3. **Errores claros**: Mensajes especÃ­ficos cuando algo falla
4. **Mobile-ready**: Funciona tanto en desktop como en mÃ³vil

## ğŸ“‹ Checklist Post-Fix

- [x] Corregida funciÃ³n uploadFile en edit/page.tsx
- [x] Corregida funciÃ³n uploadFile en lib/api/experiences.ts
- [x] Agregados logs de debugging
- [x] Mejorado manejo de errores
- [x] Verificado que no hay errores de compilaciÃ³n
- [ ] Probar upload en desktop
- [ ] Probar upload en mobile
- [ ] Verificar que los archivos se guardan correctamente

## ğŸš€ Siguiente Paso

**Recarga la pÃ¡gina** y prueba subir un archivo. Ahora deberÃ­a funcionar correctamente tanto en desktop como en mobile.

Si ves un error, revisa la consola para ver los logs detallados (ğŸ”, âœ…, âŒ, ğŸ“¤, ğŸ“±, ğŸ’»).
