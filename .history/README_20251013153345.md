# QuickAR - Plataforma de Realidad Aumentada 🚀

Una aplicación fullstack profesional para crear y compartir experiencias de Realidad Aumentada (AR) mediante códigos QR. Desarrollada con Next.js 15, .NET 9, y tecnologías AR de última generación.

[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=flat&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Next.js](https://img.shields.io/badge/Next.js-000000?style=flat&logo=next.js&logoColor=white)](https://nextjs.org/)
[![.NET](https://img.shields.io/badge/.NET-512BD4?style=flat&logo=dotnet&logoColor=white)](https://dotnet.microsoft.com/)
[![React Three Fiber](https://img.shields.io/badge/Three.js-000000?style=flat&logo=three.js&logoColor=white)](https://threejs.org/)

## ✨ Características Principales

### 🎯 **Sistema AR Dual (Móvil + Desktop)**

#### **Para Móviles (AR Real)**
- ✅ **WebXR** - AR nativo en Chrome para Android
- ✅ **Scene Viewer** - Visor AR de Google (Android)
- ✅ **Quick Look** - AR nativo de Apple (iOS)
- ✅ **Botón "Ver en AR"** - Activa cámara y overlay AR real
- ✅ **model-viewer** - Librería oficial de Google para AR web

#### **Para Desktop (Visualización 3D)**
- ✅ **React Three Fiber** - Renderizado 3D interactivo de alta calidad
- ✅ **Controles de Cámara** - Rotar, zoom, y desplazar con mouse
- ✅ **Iluminación Realista** - Sombras, reflejos y entorno dinámico
- ✅ **Grid Infinito** - Navegación espacial sin límites

### 📱 **Detección Inteligente de Dispositivo**
- 🔍 Detecta automáticamente móvil vs desktop
- 🔍 Identifica capacidades WebXR
- 🔍 Reconoce plataforma (iOS/Android)
- 🔍 Selecciona el mejor visor AR disponible
- 🔍 Fallback elegante si AR no está disponible

### 🎨 **Tipos de Assets Soportados**

| Tipo | Descripción | Formatos | AR Nativo |
|------|-------------|----------|-----------|
| **model3d** | Modelos 3D interactivos | `.glb`, `.gltf` | ✅ Sí |
| **image** | Imágenes 2D | `.jpg`, `.png`, `.webp` | ⚠️ Visualización |
| **video** | Videos con controles | `.mp4`, `.webm` | ⚠️ Visualización |
| **message** | Mensajes de texto | Texto plano | ⚠️ Visualización |
| **webcontent** | Enlaces externos | URLs | ❌ No |

### 📊 **Gestión de Experiencias**

- ✅ **CRUD Completo** - Crear, leer, actualizar, eliminar experiencias
- ✅ **Múltiples Assets** - Cada experiencia puede tener varios assets
- ✅ **Slugs Únicos** - URLs amigables para compartir
- ✅ **Generación de QR** - Códigos QR automáticos para cada experiencia
- ✅ **Analytics** - Seguimiento de interacciones de usuarios
- ✅ **Preview en Tiempo Real** - Ve tus experiencias antes de publicar

### 🎨 **Interfaz de Usuario Moderna**

- 🎨 **Glass Morphism** - Efectos de cristal y blur modernos
- 🎨 **Gradientes Dinámicos** - Fondos animados y atractivos
- 🎨 **Responsive Design** - Optimizado para todos los tamaños de pantalla
- 🎨 **Animaciones Suaves** - Transiciones y feedback visual
- 🎨 **Dark Theme** - Diseño oscuro profesional

## 🏗️ Arquitectura del Proyecto

```
QR-App/
├── QrAr.Api/                          # Backend API (.NET 9)
│   ├── Controllers/                   # Endpoints de API
│   │   ├── ExperiencesController.cs   # CRUD de experiencias
│   │   ├── FilesController.cs         # Upload de archivos
│   │   ├── AnalyticsController.cs     # Tracking de eventos
│   │   └── AuthEndpointGroup.cs       # Autenticación JWT
│   ├── Models/                        # Modelos de dominio
│   │   ├── Experience.cs              # Experiencia AR
│   │   ├── Asset.cs                   # Asset (3D, imagen, etc)
│   │   ├── User.cs                    # Usuario del sistema
│   │   └── AnalyticsEvent.cs          # Evento de analytics
│   ├── Services/                      # Lógica de negocio
│   │   ├── ExperienceService.cs       # Servicio de experiencias
│   │   ├── FileUploadService.cs       # Servicio de uploads
│   │   ├── AnalyticsService.cs        # Servicio de analytics
│   │   └── AuthService.cs             # Servicio de autenticación
│   ├── Data/                          # Acceso a datos
│   │   └── AppDbContext.cs            # Contexto de EF Core
│   └── wwwroot/uploads/               # Archivos subidos
│
└── qr-ar-admin/                       # Frontend (Next.js 15)
    ├── src/
    │   ├── app/                       # App Router de Next.js
    │   │   ├── ar/[id]/               # Visor AR unificado
    │   │   ├── experiences/           # Gestión de experiencias
    │   │   ├── analytics/             # Dashboard de analytics
    │   │   └── login/                 # Autenticación
    │   ├── components/
    │   │   ├── ar/                    # Componentes AR
    │   │   │   ├── UnifiedARViewer.tsx       # 🆕 Viewer unificado
    │   │   │   ├── MobileARViewer.tsx        # 🆕 AR para móviles
    │   │   │   ├── Desktop3DViewer.tsx       # 🆕 3D para desktop
    │   │   │   ├── EnhancedAssetRenderers.tsx # Renderers 3D
    │   │   │   └── RealisticARViewer.tsx     # Viewer legacy
    │   │   ├── ui/                    # Componentes UI
    │   │   └── ProtectedRoute.tsx     # Control de acceso
    │   ├── hooks/
    │   │   └── useARCapabilities.ts   # 🆕 Detección de capacidades AR
    │   ├── lib/
    │   │   ├── api/                   # Clientes de API
    │   │   │   └── experiences.ts     # API de experiencias
    │   │   ├── assetUtils.ts          # 🆕 Utilidades de assets
    │   │   └── helpers/               # Funciones auxiliares
    │   ├── types/
    │   │   ├── index.ts               # Tipos principales
    │   │   └── model-viewer.d.ts      # 🆕 Tipos de model-viewer
    │   └── styles/
    │       ├── globals.css            # Estilos globales
    │       └── model-viewer.css       # 🆕 Estilos de AR
    └── public/                        # Archivos estáticos
```

## 🔧 Tecnologías Utilizadas

### Backend (.NET 9)

| Tecnología | Versión | Propósito |
|------------|---------|-----------|
| **.NET** | 9.0 | Framework principal |
| **Entity Framework Core** | 9.0 | ORM y gestión de BD |
| **SQLite** | Latest | Base de datos |
| **Minimal APIs** | - | Endpoints REST ligeros |
| **Swagger/OpenAPI** | - | Documentación de API |
| **JWT Authentication** | - | Autenticación segura |

### Frontend (Next.js 15)

| Tecnología | Versión | Propósito |
|------------|---------|-----------|
| **Next.js** | 15.0 | Framework React |
| **TypeScript** | 5.0+ | Tipado estático |
| **Tailwind CSS** | 3.4 | Estilos utility-first |
| **React Three Fiber** | 8.18 | Renderizado 3D |
| **@react-three/drei** | 9.122 | Helpers para Three.js |
| **Three.js** | 0.164 | Motor 3D |
| **model-viewer** | 3.4+ | AR web de Google |
| **QRCode** | 1.5 | Generación de QR |
| **Zustand** | 4.5 | State management |
| **Framer Motion** | 11.18 | Animaciones |

## 🚀 Guía de Instalación

### Prerrequisitos

Asegúrate de tener instalado:

- ✅ **Node.js** 20.0 o superior
- ✅ **.NET SDK** 9.0
- ✅ **Git** para control de versiones
- ✅ **PowerShell** 7+ (Windows) o Bash (Linux/Mac)

### 1. Clonar el Repositorio

```powershell
git clone https://github.com/JuanPabloTorres/QuickAR.git
cd QuickAR
```

### 2. Configurar Backend (.NET API)

```powershell
# Navegar a la carpeta del API
cd QrAr.Api

# Restaurar dependencias
dotnet restore

# Aplicar migraciones de base de datos
dotnet ef database update

# Ejecutar el servidor (modo desarrollo)
dotnet run

# O usar watch para auto-reload
dotnet watch run
```

El API estará disponible en:
- 🌐 HTTP: `http://localhost:5001`
- 🔒 HTTPS: `https://localhost:5002`
- 📚 Swagger: `https://localhost:5002/swagger`

### 3. Configurar Frontend (Next.js)

```powershell
# Navegar a la carpeta del frontend
cd qr-ar-admin

# Instalar dependencias
npm install

# Ejecutar en desarrollo
npm run dev

# O para desarrollo con HTTPS
npm run dev:https
```

El frontend estará disponible en:
- 🌐 HTTP: `http://localhost:3001`
- 🔒 HTTPS: `https://localhost:3000` (con dev:https)

### 4. Configuración de Variables de Entorno

#### Backend (`QrAr.Api/appsettings.json`)

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=qr_ar.db"
  },
  "Jwt": {
    "Key": "tu-clave-secreta-super-segura-aqui",
    "Issuer": "QuickAR",
    "Audience": "QuickAR-Users"
  },
  "AllowedOrigins": [
    "http://localhost:3001",
    "https://localhost:3000"
  ]
}
```

#### Frontend (`.env.local`)

```env
# API Backend URL
NEXT_PUBLIC_API_BASE_URL=http://localhost:5001

# Para producción
# NEXT_PUBLIC_API_BASE_URL=https://tu-api.com
```

## 📱 Guía de Uso

### Crear una Experiencia AR

1. **Acceder al Panel Admin**
   - Navega a `http://localhost:3001`
   - Inicia sesión (o regístrate)

2. **Crear Nueva Experiencia**
   - Click en "Nueva Experiencia"
   - Completa el formulario:
     - **Título**: Nombre descriptivo
     - **Slug**: URL amigable (auto-generado)
     - **Descripción**: Descripción opcional

3. **Agregar Assets**
   - Click en "Agregar Asset"
   - Selecciona el tipo:
     - 📦 **Modelo 3D**: Sube archivo `.glb` o `.gltf`
     - 🖼️ **Imagen**: Sube `.jpg`, `.png`, `.webp`
     - 🎥 **Video**: Sube `.mp4`, `.webm`
     - 💬 **Mensaje**: Escribe texto
     - 🌐 **Web Content**: Ingresa URL
   - Completa los campos y guarda

4. **Generar Código QR**
   - El sistema genera automáticamente un QR
   - Descarga o comparte el enlace

5. **Ver en AR**
   - Escanea el QR con tu móvil
   - O accede directamente a la URL
   - El sistema detectará automáticamente tu dispositivo
   - **Móvil**: Verás botón "Ver en AR" para modelos 3D
   - **Desktop**: Verás visualización 3D interactiva

### Probar AR en Diferentes Dispositivos

#### En Android:
1. Abre Chrome en tu Android
2. Escanea el QR o accede a la URL
3. Para modelos 3D, verás el botón "Ver en AR"
4. Click para activar la cámara y ver en tu espacio

#### En iOS:
1. Abre Safari en tu iPhone/iPad
2. Escanea el QR o accede a la URL
3. Para modelos 3D, aparecerá el ícono de AR
4. Tap para usar Quick Look AR nativo

#### En Desktop:
1. Abre cualquier navegador moderno
2. Accede a la URL de la experiencia
3. Usa mouse para interactuar:
   - **Click izquierdo + arrastrar**: Rotar
   - **Scroll**: Zoom
   - **Click derecho + arrastrar**: Desplazar
   - **Click en objeto**: Seleccionar

## 🎯 Endpoints de API

### Experiencias

```http
GET    /api/v1/experiences              # Listar todas
GET    /api/v1/experiences/{id}         # Obtener por ID
GET    /api/v1/experiences/slug/{slug}  # Obtener por slug
POST   /api/v1/experiences              # Crear nueva
PUT    /api/v1/experiences/{id}         # Actualizar
DELETE /api/v1/experiences/{id}         # Eliminar
PATCH  /api/v1/experiences/{id}/toggle-active  # Activar/Desactivar
```

### Assets de Archivo

```http
POST   /api/files/upload                # Subir archivo
GET    /uploads/{filename}              # Descargar archivo
```

### Analytics

```http
POST   /api/analytics/track             # Registrar evento
GET    /api/analytics/experience/{id}   # Estadísticas por experiencia
```

### Autenticación

```http
POST   /api/auth/register               # Registrar usuario
POST   /api/auth/login                  # Iniciar sesión
POST   /api/auth/refresh                # Refrescar token
```

## 🎨 Arquitectura AR Explicada

### Flujo de Detección y Renderizado

```
Usuario accede a /ar/[id]
         ↓
┌────────────────────────┐
│  UnifiedARViewer       │  ← Componente principal
│  - Detecta dispositivo │
│  - Verifica capacidades│
└────────────────────────┘
         ↓
    ¿Móvil o AR disponible?
         ↓
    ┌────┴────┐
    │         │
   SÍ        NO
    │         │
    ↓         ↓
┌─────────┐ ┌──────────────┐
│ Mobile  │ │ Desktop      │
│ AR      │ │ 3D Viewer    │
│ Viewer  │ │              │
└─────────┘ └──────────────┘
    │              │
    ↓              ↓
model-viewer   React Three
WebXR/Scene       Fiber
Viewer/Quick      + drei
Look
```

### Componentes AR Clave

#### 1. **UnifiedARViewer** 🎯
- Punto de entrada principal
- Detecta capacidades del dispositivo
- Rutea al viewer apropiado
- Maneja estados de carga y error

#### 2. **MobileARViewer** 📱
- Usa `<model-viewer>` de Google
- Soporta WebXR, Scene Viewer, Quick Look
- Botón "Ver en AR" prominente
- Renderiza todos los tipos de assets

#### 3. **Desktop3DViewer** 🖥️
- Usa React Three Fiber
- Escena 3D interactiva completa
- Controles de cámara orbital
- Iluminación y sombras realistas

#### 4. **useARCapabilities** 🔍
- Hook personalizado
- Detecta tipo de dispositivo
- Verifica soporte WebXR
- Identifica plataforma (iOS/Android)
- Retorna capacidades disponibles

## 🧪 Testing y QA

### Checklist de Pruebas

#### Desktop
- [ ] Visualización 3D funciona en Chrome
- [ ] Visualización 3D funciona en Firefox
- [ ] Visualización 3D funciona en Safari
- [ ] Controles de cámara responsive
- [ ] Assets se cargan correctamente
- [ ] Navegación entre assets fluida

#### Android
- [ ] Chrome: WebXR funciona
- [ ] Chrome: Scene Viewer funciona
- [ ] Firefox: Visualización funciona
- [ ] Botón AR visible y funcional
- [ ] Cámara se activa correctamente

#### iOS
- [ ] Safari: Quick Look funciona
- [ ] Chrome: Visualización funciona
- [ ] Botón AR visible
- [ ] Assets se descargan correctamente

### Comandos de Testing

```powershell
# Frontend - Type checking
cd qr-ar-admin
npm run type-check

# Frontend - Linting
npm run lint

# Backend - Unit tests
cd QrAr.Api
dotnet test

# Backend - Build
dotnet build
```

## 📈 Roadmap

### Versión 1.1 (Q4 2025)
- [ ] Editor AR en tiempo real
- [ ] Plantillas de experiencias predefinidas
- [ ] Exportación de experiencias
- [ ] Colaboración multi-usuario

### Versión 1.2 (Q1 2026)
- [ ] Marketplace de assets 3D
- [ ] Animaciones en modelos 3D
- [ ] Audio espacial
- [ ] Geolocalización AR

### Versión 2.0 (Q2 2026)
- [ ] AR Cloud (persistencia)
- [ ] Multiplayer AR
- [ ] IA generativa de assets
- [ ] WebGPU para mejor rendimiento

## 🐛 Solución de Problemas

### Error: "AR no disponible"
**Causa**: Dispositivo no soporta AR o conexión no segura
**Solución**:
- Verifica que estás usando HTTPS o localhost
- Asegúrate que el dispositivo soporta WebXR
- En Android, actualiza Chrome a última versión
- En iOS, usa Safari (no Chrome)

## 📄 Licencia

MIT License - Consulta el archivo [LICENSE](LICENSE) para más detalles.

## 🤝 Contribuir

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## 📞 Soporte

Si tienes preguntas o necesitas ayuda, por favor abre un issue en el repositorio.
