# Migración a MySQL

## ✅ Completado

La aplicación ahora usa **MySQL 8.0** en lugar de SQLite.

### 🐳 Docker Compose

**Archivo:** `docker-compose.yml`

```yaml
services:
  mysql:
    image: mysql:8.0
    container_name: quickar-mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_DATABASE: quickar_db
      MYSQL_USER: quickar_user
      MYSQL_PASSWORD: QuickAR_Pass_2025!
```

### 📦 Comandos Docker

**Iniciar MySQL:**
```bash
docker-compose up -d
```

**Ver logs:**
```bash
docker-compose logs -f mysql
```

**Detener MySQL:**
```bash
docker-compose down
```

**Detener y eliminar volúmenes (⚠️ elimina todos los datos):**
```bash
docker-compose down -v
```

### 🔌 Conexión

**Connection String:**
```
Server=localhost;Port=3306;Database=quickar_db;User=quickar_user;Password=QuickAR_Pass_2025!;CharSet=utf8mb4;
```

**Cliente GUI recomendado:**
- MySQL Workbench
- DBeaver
- TablePlus

### 🔐 Usuario de Prueba Creado

**Email:** `jenniffermaldonado1992@gmail.com`  
**Password:** `123456`

### 📊 Tablas Creadas

- ✅ `Users` - Usuarios con autenticación
- ✅ `Experiences` - Experiencias AR (con UserId)
- ✅ `Assets` - Assets 3D/Images de experiencias
- ✅ `AnalyticsEvents` - Eventos de analytics

### 🔄 Migraciones

**Crear nueva migración:**
```bash
cd QrAr.Api
dotnet ef migrations add NombreDeMigracion
```

**Aplicar migraciones:**
```bash
dotnet ef database update
```

**Eliminar última migración:**
```bash
dotnet ef migrations remove
```

### 🚀 Iniciar Aplicación

1. **Levantar MySQL:**
   ```bash
   docker-compose up -d
   ```

2. **Iniciar Backend:**
   ```bash
   cd QrAr.Api
   dotnet watch run
   ```
   Backend: http://localhost:5001

3. **Iniciar Frontend:**
   ```bash
   cd qr-ar-admin
   npm run dev
   ```
   Frontend: http://localhost:3001

### 📝 Cambios Realizados

1. ✅ Reemplazado `Microsoft.EntityFrameworkCore.Sqlite` con `Pomelo.EntityFrameworkCore.MySql 8.0.2`
2. ✅ Actualizado `Program.cs` para usar `UseMySql` en lugar de `UseSqlite`
3. ✅ Configurado connection strings en `appsettings.json` y `appsettings.Development.json`
4. ✅ Eliminadas migraciones antiguas de SQLite
5. ✅ Creada nueva migración inicial para MySQL: `InitialMySqlMigration`
6. ✅ Aplicadas migraciones a la base de datos MySQL
7. ✅ Creado usuario de prueba

### 🔍 Verificar Base de Datos

**Usando docker exec:**
```bash
docker exec -it quickar-mysql mysql -u quickar_user -p
# Password: QuickAR_Pass_2025!
```

**Comandos SQL útiles:**
```sql
USE quickar_db;
SHOW TABLES;
SELECT * FROM Users;
SELECT * FROM Experiences;
DESCRIBE Users;
```

### ⚙️ Configuración de Entity Framework

**Versiones:**
- Entity Framework Core: 8.0.11
- Pomelo MySQL Provider: 8.0.2
- MySQL Server: 8.0

**Características habilitadas:**
- ✅ Retry on failure (5 reintentos)
- ✅ UTF8MB4 charset (soporte completo de emojis y caracteres especiales)
- ✅ Índices únicos en Email y Username
- ✅ Foreign keys con cascade delete
- ✅ Relación User → Experiences (1:N)

### 🎯 Ventajas de MySQL sobre SQLite

1. ✅ **Mejor rendimiento** con múltiples usuarios concurrentes
2. ✅ **Escalabilidad** para producción
3. ✅ **Transacciones ACID** completas
4. ✅ **Índices optimizados** para consultas rápidas
5. ✅ **Volúmenes Docker** para persistencia de datos
6. ✅ **Fácil backup** con `mysqldump`
7. ✅ **Conexión remota** desde otras aplicaciones
8. ✅ **Herramientas GUI** profesionales disponibles

### 🔒 Seguridad

**⚠️ IMPORTANTE para Producción:**

Cambiar las credenciales en `docker-compose.yml` y `appsettings.json`:
- `MYSQL_ROOT_PASSWORD`
- `MYSQL_PASSWORD`
- Connection string password

**Mejores prácticas:**
- Usar variables de entorno en lugar de passwords hardcodeadas
- Configurar SSL/TLS para conexiones
- Restringir acceso por IP si es necesario
- Usar secretos de Docker o Azure Key Vault en producción
